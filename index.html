<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>NREMT Exam Prep</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{overflow:visible}
body{background:#0a0e1a;color:#fff;font-family:-apple-system,SF Pro,Inter,system-ui,sans-serif;
  touch-action:pan-y;min-height:100dvh;
  background-image:radial-gradient(ellipse at 20% 50%,rgba(74,158,255,.15) 0%,transparent 50%),
    radial-gradient(ellipse at 80% 20%,rgba(217,83,79,.12) 0%,transparent 50%),
    radial-gradient(ellipse at 50% 80%,rgba(52,199,89,.1) 0%,transparent 50%);
  background-attachment:fixed;padding:16px;padding-bottom:env(safe-area-inset-bottom,16px)}
.glass{background:rgba(20,25,41,.35);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border:1px solid rgba(255,255,255,.12);box-shadow:0 4px 24px rgba(0,0,0,.3);border-radius:16px;padding:20px}
.screen{display:none;max-width:700px;margin:0 auto}
.screen.active{display:block}
h1{font-size:1.8rem;font-weight:700;letter-spacing:-.02em}
h2{font-size:1.3rem;font-weight:600;margin-bottom:12px}
h3{font-size:1.1rem;font-weight:600;margin-bottom:8px}
.subtitle{color:rgba(255,255,255,.6);font-size:.95rem;margin-top:4px}
.stats-row{display:flex;gap:10px;margin:20px 0;flex-wrap:wrap}
.stat-card{flex:1;min-width:90px;text-align:center;padding:14px 8px}
.stat-card .num{font-size:1.6rem;font-weight:700;color:#4a9eff}
.stat-card .lbl{font-size:.75rem;color:rgba(255,255,255,.5);margin-top:2px}
.btn{display:inline-flex;align-items:center;justify-content:center;padding:14px 28px;border-radius:12px;border:none;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s;-webkit-tap-highlight-color:transparent;min-height:48px}
.btn-primary{background:linear-gradient(135deg,#4a9eff,#2d7be5);color:#fff;width:100%}
.btn-primary:active{transform:scale(.97);filter:brightness(.9)}
.btn-secondary{background:rgba(255,255,255,.1);color:#fff;border:1px solid rgba(255,255,255,.15)}
.btn-secondary:active{background:rgba(255,255,255,.18)}
.btn-sm{padding:10px 16px;font-size:.85rem;min-height:40px}
.btn-disabled{opacity:.4;pointer-events:none}
.level-list{display:flex;flex-direction:column;gap:12px;margin:16px 0}
.level-card{padding:18px 20px;border-radius:14px;cursor:pointer;transition:all .15s;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);display:flex;flex-direction:column;gap:4px}
.level-card:active{transform:scale(.98)}
.level-card .level-title{font-size:1.05rem;font-weight:600}
.level-card .level-sub{font-size:.85rem;color:rgba(255,255,255,.5)}
.level-card .level-count{font-size:.8rem;color:#4a9eff;margin-top:4px}
.level-card.disabled{opacity:.4;cursor:default}
.level-card.disabled:active{transform:none}
.domain-list{display:flex;flex-direction:column;gap:8px;margin:16px 0}
.domain-item{padding:14px 16px;border-radius:12px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:all .15s;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08)}
.domain-item:active,.domain-item.sel{background:rgba(74,158,255,.18);border-color:rgba(74,158,255,.4)}
.domain-item .ct{color:rgba(255,255,255,.4);font-size:.85rem}
.count-selector{display:flex;align-items:center;gap:16px;justify-content:center;margin:20px 0}
.count-selector button{width:44px;height:44px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.1);color:#fff;font-size:1.3rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
.count-selector button:active{background:rgba(74,158,255,.3)}
.count-selector .count-val{font-size:1.8rem;font-weight:700;min-width:60px;text-align:center}
/* Progress bar */
.progress-wrap{height:6px;background:rgba(255,255,255,.1);border-radius:3px;margin-bottom:16px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,#4a9eff,#34c759);border-radius:3px;transition:width .3s}
/* Scenario panel */
.scenario-panel{margin-bottom:16px}
.scenario-tabs{display:flex;gap:6px;margin-bottom:10px}
.scenario-tab{padding:8px 14px;border-radius:8px;font-size:.8rem;font-weight:600;cursor:pointer;background:rgba(255,255,255,.08);color:rgba(255,255,255,.4);border:1px solid transparent;transition:all .15s}
.scenario-tab.active{background:rgba(74,158,255,.2);color:#4a9eff;border-color:rgba(74,158,255,.3)}
.scenario-tab.locked{opacity:.35;cursor:default}
.scenario-text{font-size:.92rem;line-height:1.5;color:rgba(255,255,255,.8);min-height:40px}
/* Question area */
.q-text{font-size:1.05rem;line-height:1.5;margin-bottom:16px;font-weight:500}
.q-hint{font-size:.85rem;color:#4a9eff;margin-bottom:12px}
/* MC / MR options */
.opt-list{display:flex;flex-direction:column;gap:8px}
.opt{padding:14px 16px;border-radius:12px;cursor:pointer;display:flex;align-items:center;gap:12px;transition:all .15s;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);font-size:.95rem;min-height:48px;-webkit-tap-highlight-color:transparent}
.opt:active{background:rgba(255,255,255,.12)}
.opt.selected{background:rgba(74,158,255,.18);border-color:rgba(74,158,255,.4)}
.opt.correct-show{background:rgba(52,199,89,.2);border-color:rgba(52,199,89,.5)}
.opt.wrong-show{background:rgba(217,83,79,.2);border-color:rgba(217,83,79,.5)}
.opt-marker{width:28px;height:28px;border-radius:50%;border:2px solid rgba(255,255,255,.25);display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:.8rem;font-weight:600}
.opt.selected .opt-marker{border-color:#4a9eff;background:rgba(74,158,255,.3)}
.opt-marker.check{border-radius:6px}
/* Order items */
.order-list{display:flex;flex-direction:column;gap:8px}
.order-item{display:flex;align-items:center;gap:10px;padding:12px 14px;border-radius:12px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08)}
.order-item .arrows{display:flex;flex-direction:column;gap:2px}
.order-item .arrows button{width:36px;height:30px;border:none;background:rgba(255,255,255,.1);color:#fff;border-radius:6px;font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
.order-item .arrows button:active{background:rgba(74,158,255,.3)}
.order-item .order-text{flex:1;font-size:.95rem}
.order-item.correct-show{background:rgba(52,199,89,.15);border-color:rgba(52,199,89,.4)}
.order-item.wrong-show{background:rgba(217,83,79,.15);border-color:rgba(217,83,79,.4)}
/* Categorize */
.cat-items{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:14px}
.cat-chip{padding:10px 16px;border-radius:10px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);cursor:pointer;font-size:.9rem;transition:all .15s}
.cat-chip:active,.cat-chip.picked{background:rgba(74,158,255,.25);border-color:rgba(74,158,255,.4)}
.cat-chip.placed{opacity:.4;cursor:default}
.cat-buckets{display:flex;gap:10px;flex-wrap:wrap}
.cat-bucket{flex:1;min-width:140px;min-height:80px;border-radius:12px;padding:12px;background:rgba(255,255,255,.04);border:2px dashed rgba(255,255,255,.15);transition:all .15s;cursor:pointer}
.cat-bucket.highlight{border-color:rgba(74,158,255,.5);background:rgba(74,158,255,.08)}
.cat-bucket-title{font-size:.8rem;font-weight:600;color:rgba(255,255,255,.5);margin-bottom:8px;text-transform:uppercase;letter-spacing:.04em}
.cat-bucket-items{display:flex;flex-wrap:wrap;gap:6px}
.cat-bucket-items .placed-chip{padding:6px 12px;border-radius:8px;background:rgba(74,158,255,.2);font-size:.85rem;cursor:pointer}
/* Table */
.table-scroll{overflow-x:auto;-webkit-overflow-scrolling:touch;margin:0 -4px;padding:0 4px}
.q-table{width:100%;min-width:420px;border-collapse:separate;border-spacing:0;overflow:hidden;border-radius:12px;border:1px solid rgba(255,255,255,.1)}
.q-table th,.q-table td{padding:10px 8px;text-align:center;border-bottom:1px solid rgba(255,255,255,.08)}
.q-table th{background:rgba(255,255,255,.08);font-size:.75rem;font-weight:600;color:rgba(255,255,255,.6);white-space:nowrap}
.q-table td{font-size:.82rem;line-height:1.3}
.q-table td:first-child{text-align:left;font-weight:500;min-width:100px;max-width:160px}
.q-table .cell-btn{width:36px;height:36px;border-radius:8px;border:2px solid rgba(255,255,255,.2);background:transparent;color:#fff;cursor:pointer;font-size:1rem;display:inline-flex;align-items:center;justify-content:center;transition:all .15s}
.cell-btn.on{background:rgba(74,158,255,.3);border-color:#4a9eff}
.cell-btn.correct-show{background:rgba(52,199,89,.3);border-color:#34c759}
.cell-btn.wrong-show{background:rgba(217,83,79,.3);border-color:#d9534f}
/* Graphical */
.q-image{width:100%;max-height:200px;object-fit:contain;border-radius:12px;margin-bottom:14px;background:rgba(255,255,255,.05)}
.q-image-placeholder{width:100%;padding:40px;text-align:center;border-radius:12px;margin-bottom:14px;background:rgba(255,255,255,.05);border:1px dashed rgba(255,255,255,.15);color:rgba(255,255,255,.4);font-size:.9rem}
/* Explanation */
.explanation{margin-top:16px;padding:16px;border-radius:12px;background:rgba(52,199,89,.1);border:1px solid rgba(52,199,89,.25)}
.explanation.wrong{background:rgba(217,83,79,.1);border-color:rgba(217,83,79,.25)}
.explanation h4{font-size:.9rem;margin-bottom:6px}
.explanation p{font-size:.9rem;line-height:1.5;color:rgba(255,255,255,.8)}
.pearl{margin-top:10px;padding:12px;border-radius:10px;background:rgba(74,158,255,.1);border:1px solid rgba(74,158,255,.2);font-size:.85rem;color:rgba(255,255,255,.75)}
.pearl strong{color:#4a9eff}
/* Results */
.score-circle{width:140px;height:140px;border-radius:50%;margin:20px auto;display:flex;flex-direction:column;align-items:center;justify-content:center;border:4px solid #4a9eff;background:rgba(74,158,255,.1)}
.score-circle .pct{font-size:2.2rem;font-weight:700}
.score-circle .tier{font-size:.8rem;color:rgba(255,255,255,.6)}
.domain-breakdown{margin:20px 0}
.domain-bar{margin-bottom:10px}
.domain-bar-label{display:flex;justify-content:space-between;font-size:.85rem;margin-bottom:4px}
.domain-bar-track{height:8px;background:rgba(255,255,255,.1);border-radius:4px;overflow:hidden}
.domain-bar-fill{height:100%;border-radius:4px;transition:width .5s}
.review-item{margin-bottom:12px;padding:14px;border-radius:12px;font-size:.9rem}
.review-item.rev-correct{background:rgba(52,199,89,.1);border:1px solid rgba(52,199,89,.2)}
.review-item.rev-wrong{background:rgba(217,83,79,.1);border:1px solid rgba(217,83,79,.2)}
.review-q{font-weight:600;margin-bottom:4px}
.review-a{color:rgba(255,255,255,.6);font-size:.85rem}
.mt{margin-top:16px}
.mb{margin-bottom:16px}
.gap{height:12px}
.back-link{display:inline-flex;align-items:center;gap:6px;color:rgba(255,255,255,.5);font-size:.9rem;cursor:pointer;margin-bottom:16px;-webkit-tap-highlight-color:transparent}
.back-link:active{color:#4a9eff}
</style>
</head>
<body>

<!-- HOME SCREEN -->
<div id="home" class="screen active">
  <div class="glass" style="text-align:center;padding:30px 20px">
    <h1>NREMT Exam Prep</h1>
    <p class="subtitle">National Registry Certification Practice</p>
  </div>
  <div class="stats-row">
    <div class="glass stat-card"><div class="num" id="homeStatQ">60</div><div class="lbl">Questions</div></div>
    <div class="glass stat-card"><div class="num">3</div><div class="lbl">Levels</div></div>
    <div class="glass stat-card"><div class="num" id="homeStatD">5</div><div class="lbl">Domains</div></div>
  </div>
  <div class="glass">
    <h3>Select Your Certification Level</h3>
    <div class="level-list" id="levelList"></div>
  </div>
</div>

<!-- SETUP SCREEN -->
<div id="setup" class="screen">
  <div class="back-link" onclick="goHome()">Back</div>
  <div class="glass" style="text-align:center;padding:24px 20px;margin-bottom:16px">
    <h2 id="setupTitle">EMT</h2>
    <p class="subtitle" id="setupSub"></p>
  </div>
  <div class="glass">
    <h3>Select Domain</h3>
    <div class="domain-list" id="domainList"></div>
  </div>
  <div class="gap"></div>
  <div class="glass">
    <h3 style="text-align:center">Number of Questions</h3>
    <div class="count-selector">
      <button onclick="adjCount(-5)">-</button>
      <div class="count-val" id="countVal">10</div>
      <button onclick="adjCount(5)">+</button>
    </div>
  </div>
  <div class="gap"></div>
  <button class="btn btn-primary" onclick="startQuiz()">Start Practice</button>
</div>

<!-- QUIZ SCREEN -->
<div id="quiz" class="screen">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
    <button class="btn btn-secondary btn-sm" onclick="goHome()">Exit</button>
    <span id="qCounter" style="font-size:.85rem;color:rgba(255,255,255,.5)"></span>
  </div>
  <div class="progress-wrap"><div class="progress-fill" id="progFill"></div></div>
  <div id="scenarioPanel" class="glass scenario-panel" style="display:none">
    <div class="scenario-tabs" id="scenarioTabs"></div>
    <div class="scenario-text" id="scenarioText"></div>
  </div>
  <div class="glass" id="questionCard">
    <div id="qImageArea"></div>
    <div class="q-text" id="qText"></div>
    <div class="q-hint" id="qHint" style="display:none"></div>
    <div id="qBody"></div>
    <div id="qExplanation" style="display:none"></div>
  </div>
  <div class="gap"></div>
  <button class="btn btn-primary" id="submitBtn" onclick="submitAnswer()">Submit</button>
  <button class="btn btn-primary mt" id="nextBtn" onclick="nextQuestion()" style="display:none">Next</button>
</div>

<!-- RESULTS SCREEN -->
<div id="results" class="screen">
  <div class="glass" style="text-align:center">
    <h2>Results</h2>
    <div class="score-circle"><div class="pct" id="resPct"></div><div class="tier" id="resTier"></div></div>
  </div>
  <div class="gap"></div>
  <div class="glass">
    <h3>Domain Breakdown</h3>
    <div id="domainBreakdown" class="domain-breakdown"></div>
  </div>
  <div class="gap"></div>
  <div class="glass">
    <h3>Question Review</h3>
    <div id="reviewList"></div>
  </div>
  <div class="gap"></div>
  <button class="btn btn-primary" onclick="goHome()">Back to Home</button>
</div>

<script>
/* ===== QUESTION DATA ===== */
const QUESTIONS=[
// ——— EMT QUESTIONS (50) ———
{id:"emt-001",level:"EMT",type:"mc",domain:"Scene Size-Up and Safety",question:"You arrive at a residential call for a reported stabbing. As you approach the front door, you hear shouting from inside. What is your BEST course of action?",options:["Enter immediately to treat the patient","Stage at a safe distance and request law enforcement","Announce yourself loudly and enter","Have your partner enter while you wait by the ambulance"],correct:1,explanation:"Scene safety is the first priority. A violent scene with ongoing shouting indicates the threat may still be active. EMTs should stage and wait for law enforcement to secure the scene before entering."},
{id:"emt-002",level:"EMT",type:"mc",domain:"Scene Size-Up and Safety",question:"You are dispatched to a call for a patient with severe vomiting and diarrhea. What is the MINIMUM level of PPE you should don before patient contact?",options:["Gloves only","Gloves and eye protection","Gloves, gown, and eye protection","N95 respirator and gloves"],correct:1,explanation:"When there is potential for splash exposure from vomiting, gloves and eye protection are the minimum appropriate PPE."},
{id:"emt-003",level:"EMT",type:"mc",domain:"Scene Size-Up and Safety",question:"You arrive at a motor vehicle collision where a sedan struck a tree at approximately 40 mph. The windshield has a spider-web crack and the steering column is bent. The driver is still seated. Based on the mechanism of injury, what injuries should you have a HIGH index of suspicion for?",options:["Isolated extremity fractures","Head injury and thoracic trauma","Abdominal injury only","Minor soft tissue injuries"],correct:1,explanation:"A spider-web windshield crack suggests head impact, and a bent steering column suggests thoracic impact. This mechanism should raise suspicion for TBI, cervical spine injury, and thoracic injuries."},
{id:"emt-004",level:"EMT",type:"mc",domain:"Scene Size-Up and Safety",question:"You arrive at a two-vehicle collision at an intersection. Your initial scene size-up reveals one car with two occupants and another car with a driver. Bystanders report a pedestrian was also struck. How many patients should you initially plan for?",options:["2","3","4","5"],correct:2,explanation:"Scene size-up must account for all potential patients: two occupants in the first car, one driver in the second car, and one pedestrian — totaling four patients."},
{id:"emt-005",level:"EMT",type:"mc",domain:"Scene Size-Up and Safety",question:"You are dispatched to an industrial facility where workers report a chemical spill. You see a placard on a container displaying a \"4\" in the red diamond. This indicates:",options:["Severe health hazard","Extreme flammability","Severe reactivity hazard","Radioactive material"],correct:1,explanation:"In the NFPA 704 diamond system, the red diamond represents flammability. A rating of 4 indicates the highest flammability rating."},
{id:"emt-006",level:"EMT",type:"mc",domain:"Scene Size-Up and Safety",question:"You respond to a call at a residence for an unconscious person. Upon arrival, you notice two people lying motionless near the front door and detect a faint odor of rotten eggs. You should:",options:["Enter and begin assessing the closest patient","Retreat upwind, establish a perimeter, and call for hazmat","Enter with an N95 respirator and begin treatment","Ventilate the area by opening windows before entering"],correct:1,explanation:"The odor of rotten eggs suggests hydrogen sulfide or a natural gas leak. Multiple unconscious persons near the entrance strongly suggests a toxic atmosphere. EMTs should not enter; retreat upwind and request hazmat resources."},
{id:"emt-007",level:"EMT",type:"mc",domain:"Scene Size-Up and Safety",question:"Dispatch sends you to a residence for a 67-year-old male with \"difficulty breathing.\" Which of the following should you consider as part of determining the nature of illness?",options:["Only the patient's chief complaint","The dispatch information, patient presentation, and environmental clues","The hospital destination preference","Only the physical exam findings"],correct:1,explanation:"Determining the nature of illness requires integrating all available information: dispatch details, the patient's chief complaint, their presentation, medications and medical history, and environmental clues."},
{id:"emt-008",level:"EMT",type:"mc",domain:"Scene Size-Up and Safety",question:"You are treating a patient who is coughing up blood-tinged sputum and has a documented history of active tuberculosis. Which PPE components are appropriate?",options:["Nitrile gloves and standard surgical mask","N95 or higher respirator, gloves, and eye protection","Gloves only","Gown and gloves only"],correct:1,explanation:"Active TB requires airborne precautions. The EMT needs an N95 respirator (not a standard surgical mask), gloves, and eye protection due to blood-tinged sputum splash risk."},
{id:"emt-009",level:"EMT",type:"mc",domain:"Scene Size-Up and Safety",question:"You respond to a shooting at a convenience store. The patient was struck by a single round from a handgun in the right upper quadrant of the abdomen. You should suspect injury to:",options:["The liver","The spleen","The left kidney","The descending colon"],correct:0,explanation:"The liver occupies most of the right upper quadrant of the abdomen. A gunshot wound to the RUQ should raise high suspicion for liver injury, which can cause life-threatening hemorrhage."},
{id:"emt-010",level:"EMT",type:"mc",domain:"Primary Assessment",question:"You approach a 45-year-old female sitting on a park bench who called 911 for chest pain. She is awake, speaking in full sentences, and appears anxious. Your general impression suggests:",options:["A patient in critical condition requiring immediate intervention","A patient who appears stable but requires further assessment","A patient who does not need EMS evaluation","A patient who should be treated as a trauma alert"],correct:1,explanation:"The general impression is formed in the first few seconds. This patient is alert, speaking in full sentences, and conscious. While chest pain is potentially serious, her current presentation appears stable."},
{id:"emt-011",level:"EMT",type:"mc",domain:"Primary Assessment",question:"You are treating an unresponsive 30-year-old male found lying supine. He has sonorous (snoring) respirations. What is the MOST appropriate initial airway intervention?",options:["Insert an oropharyngeal airway immediately","Perform a head-tilt chin-lift maneuver","Begin bag-valve-mask ventilations","Suction the airway for 30 seconds"],correct:1,explanation:"Snoring respirations indicate the tongue is partially obstructing the airway. The initial intervention should be a manual airway maneuver — head-tilt chin-lift for a non-trauma patient."},
{id:"emt-012",level:"EMT",type:"mc",domain:"Primary Assessment",question:"A 7-year-old child was pulled from a swimming pool and is unresponsive. You attempt to insert an oropharyngeal airway and the child gags. Your next action should be:",options:["Force the OPA past the gag reflex","Remove the OPA and insert a nasopharyngeal airway","Remove the OPA and maintain the airway with a manual maneuver","Remove the OPA and begin chest compressions"],correct:1,explanation:"If a patient gags on an OPA, it must be removed immediately. A nasopharyngeal airway (NPA) is better tolerated in patients with an intact gag reflex."},
{id:"emt-013",level:"EMT",type:"mc",domain:"Primary Assessment",question:"A 55-year-old male is found sitting tripod position, using accessory muscles, and speaking in 2-3 word sentences. His respiratory rate is 28 breaths per minute. This patient's breathing is BEST described as:",options:["Adequate","Inadequate","Normal with mild anxiety","Agonal"],correct:1,explanation:"Signs of inadequate breathing include: use of accessory muscles, tripod positioning, inability to speak in full sentences, and tachypnea."},
{id:"emt-014",level:"EMT",type:"mc",domain:"Primary Assessment",question:"You are assessing a 22-year-old female involved in a motorcycle crash. She has a rapid, weak radial pulse at 124 bpm, cool and pale skin, and is confused. Her blood pressure is 84/60 mmHg. These findings are MOST consistent with:",options:["Neurogenic shock","Compensated hypovolemic shock","Decompensated hypovolemic shock","Psychogenic shock"],correct:2,explanation:"This patient shows signs of decompensated shock: hypotension (systolic BP <90), tachycardia, altered mental status, and cool/pale skin."},
{id:"emt-015",level:"EMT",type:"mc",domain:"Primary Assessment",question:"You call out to your patient and she opens her eyes and moans but does not give a coherent answer. Using the AVPU scale, this patient is classified as:",options:["Alert","Verbal","Painful","Unresponsive"],correct:1,explanation:"'V' (Verbal) indicates the patient responds to verbal stimuli. This patient opened her eyes and vocalized in response to your voice."},
{id:"emt-016",level:"EMT",type:"mc",domain:"Primary Assessment",question:"A 3-year-old child is sitting in his mother's lap, drooling, and making high-pitched inspiratory sounds. He is conscious and has good skin color. What is the MOST appropriate action?",options:["Perform abdominal thrusts","Attempt to visualize the airway and remove any obstruction","Allow the child to remain in a position of comfort and transport immediately","Perform back blows and chest thrusts"],correct:2,explanation:"A conscious child with stridor who is maintaining their own airway should be kept calm in a position of comfort. Agitating the child could worsen the obstruction. Rapid transport is essential."},
{id:"emt-017",level:"EMT",type:"mc",domain:"Primary Assessment",question:"You arrive to find a 60-year-old male unresponsive on the kitchen floor. He is not breathing and has no pulse. Bystanders state he collapsed 3 minutes ago. What is your FIRST action?",options:["Apply the AED","Begin high-quality chest compressions","Deliver two rescue breaths","Establish an airway with an OPA"],correct:1,explanation:"Per current guidelines (AHA/ILCOR), the sequence for witnessed adult cardiac arrest is C-A-B. High-quality chest compressions should be initiated immediately."},
{id:"emt-018",level:"EMT",type:"mc",domain:"Primary Assessment",question:"You are ventilating an apneic adult patient with a BVM. You notice the chest is not rising with ventilations. You reposition the airway and try again with no improvement. Your next step should be:",options:["Ventilate more forcefully","Insert an oropharyngeal airway and reattempt ventilation","Begin chest compressions","Attempt blind finger sweeps"],correct:1,explanation:"When BVM ventilations fail to produce chest rise after repositioning, the next step is to use an airway adjunct (OPA) and reattempt."},
{id:"emt-019",level:"EMT",type:"mc",domain:"Primary Assessment",question:"A 35-year-old construction worker has a deep laceration to the forearm with bright red blood spurting from the wound. What is the FIRST step in controlling this hemorrhage?",options:["Apply a tourniquet proximal to the wound","Apply direct pressure with a sterile dressing","Elevate the extremity above the heart","Apply a pressure point at the brachial artery"],correct:1,explanation:"The initial step for external hemorrhage control is direct pressure with a sterile dressing."},
{id:"emt-020",level:"EMT",type:"mc",domain:"Primary Assessment",question:"You apply direct pressure to a traumatic amputation of the left leg below the knee, but blood continues to soak through multiple dressings. Your next intervention should be:",options:["Apply additional dressings and continue direct pressure","Apply a commercial tourniquet proximal to the wound","Clamp the bleeding vessel","Pack the wound with hemostatic gauze only"],correct:1,explanation:"When direct pressure fails to control life-threatening extremity hemorrhage, a tourniquet should be applied proximal to the wound."},
{id:"emt-021",level:"EMT",type:"mc",domain:"Primary Assessment",question:"A 19-year-old male dove into a shallow pool and is now lying at the edge of the pool, conscious, complaining of neck pain and tingling in both arms. You should:",options:["Apply a cervical collar and manually stabilize the spine","Assist the patient to a sitting position and assess further","Immobilize only if the patient cannot move his extremities","Wait for advanced life support to arrive before touching the patient"],correct:0,explanation:"This mechanism combined with neck pain and bilateral upper extremity tingling strongly suggests cervical spine injury. Immediate manual in-line stabilization followed by cervical collar application is indicated."},
{id:"emt-022",level:"EMT",type:"mc",domain:"Primary Assessment",question:"You are called for a 2-year-old who is \"not acting right.\" Using the Pediatric Assessment Triangle, you observe the child is limp, not making eye contact, and has mottled skin with rapid breathing. This child is BEST classified as:",options:["Stable with normal findings","Respiratory distress","Cardiopulmonary failure","Respiratory failure"],correct:2,explanation:"All three sides of the PAT are abnormal (appearance, work of breathing, circulation to skin), indicating cardiopulmonary failure."},
{id:"emt-023",level:"EMT",type:"mc",domain:"Primary Assessment",question:"A 28-year-old male fell 15 feet from a ladder and is complaining of severe back pain. He has a blood pressure of 88/50, heart rate of 56, and warm, dry skin below the level of injury. This presentation is MOST consistent with:",options:["Hypovolemic shock","Neurogenic shock","Cardiogenic shock","Anaphylactic shock"],correct:1,explanation:"Neurogenic shock results from spinal cord injury. The classic triad is hypotension, bradycardia, and warm/dry skin below the injury level."},
{id:"emt-024",level:"EMT",type:"mc",domain:"Primary Assessment",question:"During two-rescuer CPR on an adult, what is the correct compression-to-ventilation ratio and compression depth?",options:["30:2, at least 2 inches deep","15:2, at least 2 inches deep","30:2, at least 1.5 inches deep","15:2, at least 1.5 inches deep"],correct:0,explanation:"For adult CPR, the ratio is 30:2. Compressions should be at least 2 inches (5 cm) deep at a rate of 100-120 per minute."},
{id:"emt-025",level:"EMT",type:"mc",domain:"Primary Assessment",question:"You are performing CPR on an adult patient and the AED is now available. After applying the pads, the AED analyzes and advises \"No shock advised.\" You should:",options:["Remove the AED pads and continue CPR","Immediately resume CPR for 2 minutes","Check for a pulse before resuming CPR","Turn off the AED and transport immediately"],correct:1,explanation:"When the AED advises no shock, immediately resume CPR starting with compressions for 2 minutes. The AED pads should remain in place."},
{id:"emt-026",level:"EMT",type:"mc",domain:"Primary Assessment",question:"A 70-year-old female with a history of COPD is found in severe respiratory distress. She is cyanotic, has diminished breath sounds bilaterally, and a respiratory rate of 8. Her SpO2 reads 78%. You should:",options:["Apply a nasal cannula at 2 LPM and transport","Apply a non-rebreather mask at 15 LPM","Assist ventilations with a BVM at 15 LPM oxygen","Withhold oxygen due to COPD history"],correct:2,explanation:"This patient has inadequate breathing (rate of 8, cyanosis, SpO2 78%). A respiratory rate below 10 with signs of hypoxia requires assisted ventilations with a BVM."},
{id:"emt-027",level:"EMT",type:"mc",domain:"Primary Assessment",question:"A 72-year-old male presents with sudden onset right-sided facial droop, slurred speech, and left arm weakness. His symptoms began 45 minutes ago. Which prehospital stroke scale finding is this patient demonstrating?",options:["Positive Cincinnati Prehospital Stroke Scale — all three components","Negative Cincinnati Prehospital Stroke Scale","Positive for facial droop only","Findings inconsistent with stroke"],correct:0,explanation:"The Cincinnati Prehospital Stroke Scale assesses facial droop, arm drift, and speech. All three are positive here."},
{id:"emt-028",level:"EMT",type:"mc",domain:"Primary Assessment",question:"A 25-year-old female was stung by a bee 10 minutes ago. She now has widespread hives, facial swelling, wheezing, and a blood pressure of 78/40. She has a prescribed epinephrine auto-injector. You should:",options:["Administer oral diphenhydramine and transport","Assist the patient with her epinephrine auto-injector immediately","Apply cold packs to the sting site and monitor","Wait for ALS for epinephrine administration"],correct:1,explanation:"This patient is in anaphylaxis. Epinephrine is the first-line treatment. EMTs can assist with a patient's prescribed auto-injector. Do not delay."},
{id:"emt-029",level:"EMT",type:"mc",domain:"Primary Assessment",question:"A 52-year-old male presents with crushing substernal chest pain radiating to his left arm, diaphoresis, and nausea. He has prescribed nitroglycerin. His blood pressure is 96/60. Should you assist with his nitroglycerin?",options:["Yes, administer one tablet sublingually immediately","No, his systolic blood pressure is below 100 mmHg","Yes, but only after establishing IV access","No, nitroglycerin is contraindicated with nausea"],correct:1,explanation:"Nitroglycerin is contraindicated when systolic BP is below 100 mmHg. Administering nitroglycerin to this hypotensive patient could cause dangerous hypotension."},
{id:"emt-030",level:"EMT",type:"mc",domain:"Secondary Assessment",question:"When assessing a stable medical patient, how often should you reassess vital signs?",options:["Every 5 minutes","Every 15 minutes","Every 30 minutes","Only once during transport"],correct:1,explanation:"Stable patients should have vital signs reassessed every 15 minutes. Unstable patients require reassessment every 5 minutes."},
{id:"emt-031",level:"EMT",type:"mc",domain:"Secondary Assessment",question:"You are obtaining a SAMPLE history from a patient with abdominal pain. The \"M\" in SAMPLE stands for:",options:["Mechanism of injury","Medications","Medical history","Mental status"],correct:1,explanation:"SAMPLE: Signs/Symptoms, Allergies, Medications, Pertinent past medical history, Last oral intake, Events leading up to the incident."},
{id:"emt-032",level:"EMT",type:"mc",domain:"Secondary Assessment",question:"During a secondary assessment of a trauma patient, you palpate crepitus over the right lateral chest wall. This finding suggests:",options:["Subcutaneous emphysema","Rib fractures","Abdominal distension","Muscle spasm"],correct:1,explanation:"Crepitus palpated over the chest wall indicates bone fragments moving against each other, most commonly from rib fractures."},
{id:"emt-033",level:"EMT",type:"mc",domain:"Secondary Assessment",question:"During a rapid trauma assessment of an unresponsive patient after a fall, which of the following is a component you should assess?",options:["DCAP-BTLS to all body regions","Patient's insurance information","The patient's preferred hospital","Whether the patient has an advance directive"],correct:0,explanation:"A rapid trauma assessment includes a systematic head-to-toe evaluation checking DCAP-BTLS (Deformities, Contusions, Abrasions, Punctures/Penetrations, Burns, Tenderness, Lacerations, Swelling)."},
{id:"emt-034",level:"EMT",type:"mc",domain:"Patient Treatment and Transport",question:"A patient with mild respiratory distress has an SpO2 of 92% on room air. The MOST appropriate initial oxygen delivery device is:",options:["Nasal cannula at 2-6 LPM","Non-rebreather mask at 15 LPM","Bag-valve mask at 15 LPM","Simple face mask at 6-10 LPM"],correct:0,explanation:"For patients with mild respiratory distress and an SpO2 of 92%, a nasal cannula at 2-6 LPM is appropriate."},
{id:"emt-035",level:"EMT",type:"mc",domain:"Patient Treatment and Transport",question:"A patient has a suspected fracture of the right tibia. When applying a splint, you should immobilize:",options:["Only the fracture site","The joint above and below the fracture","The entire extremity from hip to toes","Only the joint above the fracture"],correct:1,explanation:"Proper splinting technique requires immobilizing the joint above (knee) and the joint below (ankle) the suspected fracture site."},
{id:"emt-036",level:"EMT",type:"mc",domain:"Patient Treatment and Transport",question:"A 45-year-old diabetic patient is found confused, diaphoretic, and trembling. His blood glucose reads 42 mg/dL. He is able to swallow. You should:",options:["Administer oral glucose","Administer insulin","Place the patient supine and transport","Withhold all treatment and transport immediately"],correct:0,explanation:"This patient is hypoglycemic with altered mental status but can still swallow. Oral glucose is the appropriate EMT-level treatment."},
{id:"emt-037",level:"EMT",type:"mc",domain:"Patient Treatment and Transport",question:"You are preparing to immobilize a supine trauma patient on a long backboard. The correct sequence for securing the patient is:",options:["Head first, then torso, then legs","Torso first, then legs, then head","Legs first, then torso, then head","All straps simultaneously"],correct:1,explanation:"When securing a patient to a backboard, the torso is secured first, then the legs, and finally the head."},
{id:"emt-038",level:"EMT",type:"mc",domain:"Patient Treatment and Transport",question:"A 30-year-old male has full-thickness burns to his entire right arm and the anterior chest. Using the Rule of Nines for an adult, the estimated total body surface area burned is:",options:["18%","27%","9%","36%"],correct:1,explanation:"Using the adult Rule of Nines: entire right arm = 9%, anterior chest = 18%. Total = 27%."},
{id:"emt-039",level:"EMT",type:"mc",domain:"Patient Treatment and Transport",question:"A 4-year-old child accidentally ingested an unknown household cleaner approximately 20 minutes ago. The child is alert and crying. After ensuring scene safety and airway management, you should:",options:["Induce vomiting with syrup of ipecac","Administer activated charcoal immediately","Contact Poison Control and transport","Give the child milk to dilute the substance"],correct:2,explanation:"EMTs should contact Poison Control (1-800-222-1222) for guidance on specific ingestions."},
{id:"emt-040",level:"EMT",type:"mc",domain:"Patient Treatment and Transport",question:"You are assisting with a field delivery. After the baby's head delivers, you notice the umbilical cord is wrapped around the neck. You should:",options:["Push the baby's head back in and transport immediately","Attempt to gently slip the cord over the baby's head","Clamp and cut the cord immediately before the body delivers","Pull firmly on the cord to unwrap it"],correct:1,explanation:"A nuchal cord is common. The first attempt should be to gently slip the cord over the baby's head."},
{id:"emt-041",level:"EMT",type:"mc",domain:"Patient Treatment and Transport",question:"A 60-year-old homeless male is found outdoors in 25°F weather. He is confused, shivering has stopped, and his heart rate is 48 bpm. This patient is MOST likely experiencing:",options:["Mild hypothermia","Moderate hypothermia","Severe hypothermia","Frostbite without hypothermia"],correct:2,explanation:"Cessation of shivering, altered mental status, and bradycardia indicate severe hypothermia."},
{id:"emt-042",level:"EMT",type:"mc",domain:"Patient Treatment and Transport",question:"You respond to a patient who is threatening self-harm with a knife. The patient is alone in a bedroom. You should:",options:["Enter the room and try to talk the patient into dropping the knife","Retreat and wait for law enforcement to secure the scene","Attempt to restrain the patient with your partner","Call medical direction for permission to enter"],correct:1,explanation:"An armed patient is a scene safety threat. EMTs should not approach an armed individual. Retreat and request law enforcement."},
{id:"emt-043",level:"EMT",type:"mc",domain:"Patient Treatment and Transport",question:"A patient is actively seizing. Which of the following is the MOST appropriate action?",options:["Restrain the patient's extremities to prevent injury","Place a bite block between the patient's teeth","Protect the patient from injury and suction as needed","Hold the patient's tongue to prevent airway obstruction"],correct:2,explanation:"During an active seizure, move objects away to prevent injury, do not restrain. Never place objects in the mouth. After the seizure, position on their side and suction as needed."},
{id:"emt-044",level:"EMT",type:"mc",domain:"Operations",question:"When operating an ambulance with lights and sirens, you approach a red traffic light at an intersection. You should:",options:["Proceed through without stopping since you have lights and sirens","Come to a complete stop, ensure all lanes are clear, then proceed","Slow down and proceed with caution","Turn off lights and sirens before entering the intersection"],correct:1,explanation:"Even with emergency lights and sirens activated, ambulance operators must come to a complete stop at red lights and stop signs."},
{id:"emt-045",level:"EMT",type:"mc",domain:"Operations",question:"You are the first emergency unit on scene at a bus crash with approximately 20 patients. Your FIRST action in establishing incident command should be:",options:["Begin triaging patients immediately","Assume incident command and transmit a brief initial report","Request additional resources before doing anything else","Begin treating the most critically injured patient"],correct:1,explanation:"The first arriving unit should assume incident command and provide a brief initial report."},
{id:"emt-046",level:"EMT",type:"mc",domain:"Operations",question:"During START triage at a mass casualty incident, you encounter a patient who is not breathing. You open the airway and the patient begins breathing at 20 breaths per minute. This patient should be triaged as:",options:["Red (Immediate)","Yellow (Delayed)","Green (Minor)","Black (Expectant)"],correct:0,explanation:"In START triage, if a patient begins breathing after a simple airway maneuver, they are categorized as Red (Immediate)."},
{id:"emt-047",level:"EMT",type:"mc",domain:"Operations",question:"At a hazardous materials incident, patient decontamination takes place in the:",options:["Hot zone","Warm zone","Cold zone","Treatment area"],correct:1,explanation:"The warm zone (contamination reduction zone) is where decontamination takes place."},
{id:"emt-048",level:"EMT",type:"mc",domain:"Operations",question:"Your patient is trapped in a vehicle and requires extrication. While the rescue team works, the EMT's primary role is to:",options:["Operate the extrication tools","Maintain patient care and cervical spine stabilization","Direct the extrication operation","Clear debris from around the vehicle"],correct:1,explanation:"During extrication, the EMT's primary role is patient care including cervical spine stabilization and monitoring."},
{id:"emt-049",level:"EMT",type:"mc",domain:"Operations",question:"You are setting up a helicopter landing zone. The minimum recommended size for the LZ during daytime operations is:",options:["60 x 60 feet","75 x 75 feet","100 x 100 feet","50 x 50 feet"],correct:2,explanation:"The minimum recommended helicopter landing zone size is 100 x 100 feet for daytime operations."},
{id:"emt-050",level:"EMT",type:"mc",domain:"Primary Assessment",question:"You are performing two-rescuer CPR on a 5-year-old child without an advanced airway. What compression-to-ventilation ratio should you use?",options:["30:2","15:2","30:1","5:1"],correct:1,explanation:"For two-rescuer CPR on a child (age 1 to puberty), the ratio is 15:2. Pediatric cardiac arrest is more commonly respiratory in origin."},

// ——— AEMT QUESTIONS (10) ———
{id:"aemt-001",level:"AEMT",scenarioId:"s1",type:"mc",domain:"EMS Operations",
 scenario:{enRoute:"You are dispatched to a two-vehicle MVC on a highway. Dispatch reports multiple patients and possible entrapment. Police and fire are en route.",scene:"You arrive to find a sedan with significant front-end damage and a pickup truck off the roadway. Bystanders are waving you over. You see one patient still in the sedan, conscious but pinned by the dashboard. A second patient from the pickup is sitting on the guardrail holding a bloodied cloth to their head.",postScene:""},
 question:"While en route, what is the MOST important information to obtain from dispatch?",
 options:["Number of patients and mechanism of injury","Names and ages of all patients","Insurance information for the vehicles","Which hospital to transport to"],
 correct:0,
 explanation:"Knowing the number of patients and MOI helps you prepare resources, request mutual aid, and anticipate injury patterns before arrival.",
 pearl:"MOI helps predict injury patterns: high-speed frontal MVC — suspect cervical spine, chest, and abdominal injuries."},

{id:"aemt-002",level:"AEMT",scenarioId:"s1",type:"mr",domain:"EMS Operations",
 scenario:{enRoute:"",scene:"You arrive to find a sedan with significant front-end damage and a pickup truck off the roadway. Bystanders are waving you over. One patient is pinned in the sedan, another sits on the guardrail with a head laceration.",postScene:""},
 question:"Upon arrival at the scene, which TWO actions should you perform FIRST?",
 selectCount:2,
 options:["Ensure scene safety and assess hazards","Begin treating the patient in the sedan immediately","Determine the number of patients and call for additional resources","Direct bystanders to move the sedan"],
 correctMulti:[0,2],
 explanation:"Scene safety is always the first priority. Then determine number of patients so you can call for additional resources before beginning patient contact.",
 pearl:"Scene size-up: Safety → MOI → Number of patients → Need for additional resources → C-spine consideration."},

{id:"aemt-003",level:"AEMT",scenarioId:"s1",type:"order",domain:"Patient Assessment",
 scenario:{enRoute:"",scene:"Scene is safe. You have two patients. Additional EMS is 8 minutes out. You approach the patient pinned in the sedan who is responsive but confused.",postScene:""},
 question:"Place the following primary assessment steps in the correct order:",
 items:["Assess circulation (pulse, bleeding, skin)","Form a general impression","Assess airway with C-spine protection","Assess breathing (rate, quality, effort)","Determine priority/transport decision"],
 correctOrder:[1,2,3,0,4],
 explanation:"Primary assessment follows: General Impression → Airway (with C-spine) → Breathing → Circulation → Priority decision.",
 pearl:"Remember: General impression → ABCs → Priority. Never skip the general impression — it takes 2 seconds and guides your urgency."},

{id:"aemt-004",level:"AEMT",type:"mc",domain:"Cardiology",
 question:"A 62-year-old male presents with crushing substernal chest pain radiating to his left arm, diaphoresis, and nausea. His BP is 138/88, pulse 96, SpO2 94% on room air. He has prescribed nitroglycerin. After assisting with his nitroglycerin, what should you do NEXT?",
 options:["Administer 324 mg aspirin (chewed)","Apply the AED immediately","Begin CPR","Administer a second nitroglycerin immediately"],
 correct:0,
 explanation:"Aspirin (324 mg chewed) should be administered to any patient with suspected ACS, provided no allergy or contraindication.",
 pearl:"ASA for ACS: 324 mg (four 81 mg baby aspirin) chewed — not swallowed whole. Chewing speeds absorption by ~12 minutes."},

{id:"aemt-005",level:"AEMT",type:"mr",domain:"Medical Emergencies",
 question:"Which THREE of the following are signs of compensated shock in an adult?",
 selectCount:3,
 options:["Tachycardia","Hypertension","Pale, cool, diaphoretic skin","Altered mental status","Increased urine output"],
 correctMulti:[0,2,3],
 explanation:"Compensated shock presents with tachycardia, pale/cool/diaphoretic skin, and altered mental status. BP is maintained in compensated shock.",
 pearl:"In compensated shock, BP may still be normal. Tachycardia is often the earliest sign — don't wait for hypotension to suspect shock."},

{id:"aemt-006",level:"AEMT",type:"order",domain:"Medical Emergencies",
 question:"Place the following interventions for a patient experiencing anaphylaxis in the correct order:",
 items:["Assist with or administer epinephrine auto-injector","Manage the airway and provide high-flow O2","Remove the patient from the allergen/trigger","Initiate transport; reassess every 2 minutes"],
 correctOrder:[2,1,0,3],
 explanation:"First remove from trigger, then manage airway/breathing with high-flow O2, administer epinephrine, then transport with ongoing reassessment.",
 pearl:"Epinephrine is the ONLY medication that addresses all pathophysiology of anaphylaxis: bronchospasm, vasodilation, and increased permeability."},

{id:"aemt-007",level:"AEMT",type:"categorize",domain:"Patient Assessment",
 question:"For a healthy adult at rest, categorize each vital sign as Normal or Abnormal:",
 items:["HR 78 bpm","RR 24 breaths/min","BP 118/76 mmHg","SpO2 88%","Temp 98.6°F"],
 categories:["Normal","Abnormal"],
 correctCategories:[0,1,0,1,0],
 explanation:"HR 78 (normal 60-100), BP 118/76 (normal), and Temp 98.6°F (normal) are all within range. RR 24 is above normal (12-20) and SpO2 88% is hypoxic (normal ≥94%).",
 pearl:"Normal adult vitals: HR 60-100, RR 12-20, SBP 90-140, SpO2 ≥94%, Temp 97.8-99.1°F."},

{id:"aemt-008",level:"AEMT",type:"table",domain:"Pharmacology",
 question:"A 45-year-old female with a known history of asthma is experiencing an acute asthma attack with severe wheezing and SpO2 of 90%. For each medication, mark whether it is Indicated or Contraindicated:",
 rows:["Prescribed MDI albuterol","Oral glucose","Epinephrine auto-injector","Aspirin"],
 columns:["Indicated","Contraindicated"],
 correctCells:[[1,0],[0,1],[0,1],[0,1]],
 explanation:"Albuterol is the appropriate medication for acute bronchospasm. The others are not indicated for isolated asthma.",
 pearl:"EMTs can assist with patient-prescribed MDIs (albuterol). Ensure: right patient, right medication, not expired."},

{id:"aemt-009",level:"AEMT",type:"graphical",domain:"Cardiology",
 question:"You are monitoring a patient who suddenly becomes unresponsive and pulseless. The cardiac monitor shows the rhythm below. What is this rhythm?",
 imageText:"Monitor Display: Rapid, chaotic, irregularly irregular waveform with no discernible P waves, QRS complexes, or T waves. The baseline is completely disorganized with varying amplitude and frequency.",
 options:["Normal Sinus Rhythm","Ventricular Fibrillation","Atrial Fibrillation","Asystole"],
 correct:1,
 explanation:"Ventricular fibrillation (V-Fib) appears as a chaotic, disorganized rhythm with no identifiable waves. It is a shockable rhythm.",
 pearl:"V-Fib and pulseless V-Tach are the two shockable rhythms. For every minute without defibrillation, survival decreases by 7-10%."},

{id:"aemt-010",level:"AEMT",type:"categorize",domain:"Medical Emergencies",
 question:"Categorize each finding as more characteristic of Stroke or Hypoglycemia:",
 items:["Unilateral facial droop","Rapid onset of diaphoresis","Slurred speech with hemiparesis","Combative behavior that improves with oral glucose","Sudden severe headache"],
 categories:["Stroke","Hypoglycemia"],
 correctCategories:[0,1,0,1,0],
 explanation:"Unilateral facial droop, slurred speech with hemiparesis, and sudden severe headache are classic stroke findings. Diaphoresis and combativeness improving with glucose are classic hypoglycemia.",
 pearl:"Always check blood glucose on altered mental status patients — hypoglycemia can perfectly mimic stroke."},
// ——— PARAMEDIC QUESTIONS (15) ———
// ========== SCENARIO 1: Cardiac Arrest / STEMI (Cardiology) ==========
  {
    id: "para-001",
    level: "Paramedic",
    type: "graphical",
    domain: "Cardiology",
    topic: "12-Lead ECG / STEMI Recognition",
    difficulty: "hard",
    scenarioId: "scenario-cardiac-01",
    scenario: {
      enRoute: "You are dispatched to a 58-year-old male complaining of crushing substernal chest pain radiating to his left arm for the past 40 minutes. He has a history of HTN, hyperlipidemia, and type 2 diabetes. He took one aspirin at home.",
      scene: "On arrival, the patient is diaphoretic, pale, and clutching his chest. VS: HR 52, BP 82/50, RR 22, SpO2 94% on room air. You obtain a 12-lead ECG.",
      postScene: "After your initial interventions, the patient suddenly becomes unresponsive and pulseless. The monitor shows ventricular fibrillation."
    },
    phase: "enRoute",
    stem: "En route, you review your protocols. The 12-lead ECG shows ST elevation in leads II, III, and aVF with reciprocal ST depression in leads I and aVL. There is also ST elevation in V5-V6 and right-sided lead V4R. Which coronary artery is MOST likely occluded?",
    image: null,
    options: [
      "Proximal right coronary artery (RCA)",
      "Left anterior descending (LAD)",
      "Left circumflex artery (LCx)",
      "Left main coronary artery"
    ],
    correct: 0,
    explanation: "ST elevation in II, III, aVF indicates inferior STEMI. ST elevation in V4R confirms right ventricular involvement. Combined inferior + RV infarction points to a proximal RCA occlusion (before the RV marginal branch). LAD produces anterior/septal changes (V1-V4). LCx causes lateral changes. Left main would show widespread ST depression with aVR elevation.",
    clinical_pearl: "Always obtain right-sided leads (V4R) in inferior STEMI. RV infarction changes management drastically — avoid nitroglycerin and give aggressive fluid boluses for hypotension."
  },
  {
    id: "para-002",
    level: "Paramedic",
    type: "mr",
    domain: "Cardiology",
    topic: "Inferior STEMI with RV Involvement Management",
    difficulty: "hard",
    scenarioId: "scenario-cardiac-01",
    phase: "scene",
    stem: "On scene, you confirm an inferior STEMI with right ventricular involvement. The patient is hypotensive (BP 82/50) and bradycardic (HR 52). Which TWO interventions are MOST appropriate for this patient? (Select 2)",
    options: [
      "IV fluid bolus of 250-500 mL normal saline",
      "Sublingual nitroglycerin 0.4 mg",
      "Transcutaneous pacing on standby or initiated if atropine fails",
      "Furosemide 40 mg IV push",
      "Dopamine infusion at 2 mcg/kg/min"
    ],
    selectCount: 2,
    correctMulti: [0, 2],
    explanation: "RV infarction causes right-sided heart failure with preload dependence. IV fluids restore preload and improve cardiac output. Bradycardia in inferior MI is due to AV nodal ischemia (RCA supplies the AV node in 85% of people) — transcutaneous pacing should be available. Nitroglycerin is CONTRAINDICATED (reduces preload, worsening hypotension). Furosemide reduces preload further. Low-dose dopamine is a renal dose with no proven benefit here.",
    clinical_pearl: "The RV is a preload-dependent chamber. In RV infarction, think 'volume in, nitro out.' These patients may need 1-2 liters of fluid before pressors."
  },
  {
    id: "para-003",
    level: "Paramedic",
    type: "order",
    domain: "Cardiology",
    topic: "Cardiac Arrest Algorithm — VF/Pulseless VT",
    difficulty: "hard",
    scenarioId: "scenario-cardiac-01",
    phase: "postScene",
    stem: "The patient goes into cardiac arrest with ventricular fibrillation on the monitor. Place the following interventions in the correct sequence per ACLS guidelines:",
    items: [
      "Administer epinephrine 1 mg IV/IO",
      "Defibrillate at 200J biphasic",
      "Administer amiodarone 300 mg IV/IO",
      "Resume high-quality CPR for 2 minutes"
    ],
    correctOrder: [1, 3, 0, 2],
    explanation: "VF/pVT algorithm: (1) Defibrillate immediately (shock first in witnessed arrest), (2) Resume CPR for 2 minutes, (3) Epinephrine after the second shock (given during CPR), (4) Amiodarone after the third shock if VF/pVT persists. Epinephrine is given every 3-5 minutes. Amiodarone second dose is 150 mg.",
    clinical_pearl: "In witnessed VF arrest, early defibrillation is the single most important intervention. Epinephrine is given after the 2nd shock, amiodarone after the 3rd. Remember: Shock → CPR → Epi → Shock → CPR → Amio."
  },

  // ========== SCENARIO 2: Pediatric Toxicology / Seizure ==========
  {
    id: "para-004",
    level: "Paramedic",
    type: "mc",
    domain: "Medical Emergencies",
    topic: "Toxidrome Recognition",
    difficulty: "hard",
    scenarioId: "scenario-peds-tox-01",
    scenario: {
      enRoute: "You are dispatched to a 3-year-old male found by his mother next to an open bottle of her medication. She reports the child may have ingested her grandmother's 'heart pills' approximately 30 minutes ago.",
      scene: "On arrival, the child is lethargic but responsive. VS: HR 48, BP 72/40, RR 14, SpO2 97%, BGL 58 mg/dL. The monitor shows a third-degree AV block. The medication bottle is identified as digoxin 0.25 mg tablets — approximately 10 tablets are missing.",
      postScene: "After initial treatment, the child develops multifocal PVCs and a brief run of ventricular tachycardia. The serum potassium from your i-STAT reads 6.8 mEq/L."
    },
    phase: "enRoute",
    stem: "En route, dispatch updates that the child is 'acting sleepy' and the medication is a cardiac glycoside. Which toxidrome is MOST consistent with cardiac glycoside poisoning?",
    options: [
      "Bradycardia, hyperkalemia, visual disturbances, GI symptoms",
      "Tachycardia, hyperthermia, mydriasis, diaphoresis",
      "Miosis, bradycardia, excessive secretions, bronchospasm",
      "Tachycardia, hypotension, widened QRS, seizures"
    ],
    correct: 0,
    explanation: "Cardiac glycoside (digoxin) toxicity presents with bradycardia (due to enhanced vagal tone and AV block), hyperkalemia (inhibition of Na+/K+ ATPase), visual changes (yellow-green halos), and GI symptoms (nausea, vomiting). Option B describes sympathomimetic toxidrome. Option C describes cholinergic toxidrome. Option D describes sodium channel blocker (TCA) toxicity.",
    clinical_pearl: "In acute digoxin toxicity, serum potassium level is the best predictor of mortality. K+ > 5.5 mEq/L in acute ingestion is an indication for Digibind (digoxin-specific Fab antibodies) regardless of digoxin level."
  },
  {
    id: "para-005",
    level: "Paramedic",
    type: "categorize",
    domain: "Pharmacology",
    topic: "Digoxin Toxicity Management vs Contraindicated Interventions",
    difficulty: "hard",
    scenarioId: "scenario-peds-tox-01",
    phase: "scene",
    stem: "On scene, you confirm digoxin ingestion with third-degree AV block in this pediatric patient. Categorize each intervention as INDICATED or CONTRAINDICATED:",
    items: [
      "Digoxin-specific Fab antibody fragments (Digibind)",
      "Atropine 0.02 mg/kg IV",
      "Calcium chloride IV for hyperkalemia",
      "Dextrose 0.5-1 g/kg IV (D25W)",
      "Synchronized cardioversion"
    ],
    categories: ["Indicated", "Contraindicated"],
    correctCategories: [0, 0, 1, 0, 1],
    explanation: "INDICATED: Digibind is the definitive antidote for severe digoxin toxicity (life-threatening dysrhythmias, K+ > 5.5). Atropine can temporize bradycardia. Dextrose treats the hypoglycemia (BGL 58). CONTRAINDICATED: Calcium administration in digoxin toxicity can precipitate fatal 'stone heart' (cardiac standstill) — calcium potentiates digoxin's effects. Cardioversion can trigger refractory VF in digoxin toxicity.",
    clinical_pearl: "NEVER give calcium to treat hyperkalemia in digoxin toxicity. This is a classic board question. The combination of calcium and digoxin causes irreversible cardiac contracture ('stone heart')."
  },
  {
    id: "para-006",
    level: "Paramedic",
    type: "table",
    domain: "Pharmacology",
    topic: "Pediatric Medication Dosing — Digoxin Toxicity",
    difficulty: "hard",
    scenarioId: "scenario-peds-tox-01",
    phase: "postScene",
    stem: "The child (weight estimated at 15 kg by Broselow tape) now has VT and K+ of 6.8. For each medication, select the CORRECT dose for this patient:",
    rows: [
      "Digibind (Digoxin Immune Fab)",
      "Sodium bicarbonate for hyperkalemia",
      "Amiodarone if VT persists after Digibind"
    ],
    columns: [
      "Weight-based dose appropriate",
      "Fixed adult dose appropriate"
    ],
    correctCells: [[1, 0], [1, 0], [1, 0]],
    explanation: "ALL medications in pediatric patients require weight-based dosing. Digibind: dose is based on amount ingested or digoxin level (empiric dose ~10 vials in unknown ingestion, or calculated). Sodium bicarb: 1 mEq/kg IV for hyperkalemia. Amiodarone: 5 mg/kg IV over 20-60 min. Never use fixed adult doses in a 15 kg child — this is a fundamental paramedic-level principle.",
    clinical_pearl: "For unknown amount of digoxin ingested in a child, empiric Digibind dosing is typically 10-20 vials. Each vial binds 0.5 mg of digoxin. When in doubt, call Poison Control (1-800-222-1222)."
  },

  // ========== STANDALONE QUESTIONS ==========
  {
    id: "para-007",
    level: "Paramedic",
    type: "order",
    domain: "Trauma",
    topic: "Rapid Sequence Intubation (RSI)",
    difficulty: "hard",
    stem: "You are preparing to perform RSI on a 30-year-old male with a GCS of 6 after a high-speed MVC. Place the RSI steps in the correct order:",
    items: [
      "Administer succinylcholine 1.5 mg/kg IV",
      "Preoxygenate with 100% O2 via BVM for 3 minutes",
      "Apply Sellick's maneuver (cricoid pressure)",
      "Administer etomidate 0.3 mg/kg IV",
      "Perform direct laryngoscopy and place ETT"
    ],
    correctOrder: [1, 3, 0, 2, 4],
    explanation: "RSI sequence: (1) Preoxygenate — build oxygen reserve to extend safe apnea time. (2) Administer induction agent (etomidate) — sedation/unconsciousness. (3) Administer paralytic (succinylcholine) — wait for fasciculations to cease (~45-60 sec). (4) Apply cricoid pressure — reduces aspiration risk (though controversial). (5) Perform laryngoscopy and intubate. The mnemonic is 'The 7 P's' — Preparation, Preoxygenation, Pretreatment, Paralysis with induction, Protection/Positioning, Placement, Post-intubation management.",
    clinical_pearl: "Etomidate is preferred in trauma due to hemodynamic stability. Ketamine (1-2 mg/kg) is an alternative. Avoid etomidate in septic patients (adrenal suppression). Succinylcholine is contraindicated in burns >24h, crush injuries, hyperkalemia, and neuromuscular disease."
  },
  {
    id: "para-008",
    level: "Paramedic",
    type: "mc",
    domain: "Medical Emergencies",
    topic: "Waveform Capnography Interpretation",
    difficulty: "hard",
    stem: "You have intubated a 65-year-old cardiac arrest patient. During CPR, the ETCO2 has been reading 18 mmHg. After 20 minutes of resuscitation, the ETCO2 suddenly rises to 42 mmHg. What does this finding MOST likely indicate?",
    options: [
      "Return of spontaneous circulation (ROSC)",
      "Esophageal intubation",
      "Hyperventilation by the BVM operator",
      "Tension pneumothorax development"
    ],
    correct: 0,
    explanation: "A sudden, sustained rise in ETCO2 during CPR strongly suggests ROSC. Restored cardiac output dramatically increases CO2 delivery to the lungs. Esophageal intubation would show near-zero ETCO2. Hyperventilation would decrease ETCO2. Tension pneumothorax would cause a drop in ETCO2 due to decreased cardiac output. An ETCO2 persistently < 10 mmHg after 20 minutes of CPR is associated with very low survival and may be used to guide termination of resuscitation efforts.",
    clinical_pearl: "ETCO2 < 10 mmHg after 20 min of ACLS is a strong predictor of non-survival. A sudden jump to 35-45 mmHg during CPR = check for pulse immediately (likely ROSC)."
  },
  {
    id: "para-009",
    level: "Paramedic",
    type: "mr",
    domain: "Trauma",
    topic: "Tension Pneumothorax — Needle Decompression",
    difficulty: "hard",
    stem: "A 22-year-old male has a stab wound to the right chest. He is in severe respiratory distress with absent breath sounds on the right, JVD, tracheal deviation to the left, and BP 68/palp. You prepare for needle decompression. Which TWO statements are correct regarding this procedure? (Select 2)",
    options: [
      "Insert a 14-gauge catheter at the 2nd intercostal space, midclavicular line, over the top of the 3rd rib",
      "Insert the needle at the 2nd intercostal space, just below the 2nd rib to avoid the neurovascular bundle",
      "The 5th intercostal space, anterior axillary line is an acceptable alternative site",
      "A rush of air confirms correct placement; remove the needle and leave the catheter",
      "Needle decompression is definitive treatment and no further intervention is needed"
    ],
    selectCount: 2,
    correctMulti: [0, 2],
    explanation: "Correct sites for needle decompression: (1) 2nd ICS, midclavicular line — insert OVER the top of the 3rd rib (neurovascular bundle runs under each rib). (2) 5th ICS, anterior axillary line — an acceptable alternative, especially in muscular/obese patients where anterior approach may not reach the pleural space. Option B is wrong — inserting below the rib hits the neurovascular bundle. Option D is partially correct (you do leave the catheter) but you should hear a rush of air AND leave both the catheter in place. Option E is wrong — needle decompression is a temporizing measure; definitive treatment is chest tube thoracostomy.",
    clinical_pearl: "In muscular or obese patients, the standard 3.25-inch 14g catheter may not reach the pleural space via the 2nd ICS. The lateral (5th ICS, AAL) approach has a higher success rate in these patients. Always reassess — you may need to decompress again."
  },
  {
    id: "para-010",
    level: "Paramedic",
    type: "categorize",
    domain: "Cardiology",
    topic: "Synchronized Cardioversion vs Defibrillation",
    difficulty: "hard",
    stem: "Categorize each dysrhythmia as requiring SYNCHRONIZED CARDIOVERSION or UNSYNCHRONIZED DEFIBRILLATION:",
    items: [
      "Unstable SVT with a pulse",
      "Pulseless ventricular tachycardia",
      "Atrial fibrillation with RVR, hemodynamically unstable",
      "Ventricular fibrillation",
      "Unstable monomorphic VT with a pulse",
      "Polymorphic VT (Torsades de Pointes) with a pulse"
    ],
    categories: ["Synchronized Cardioversion", "Unsynchronized Defibrillation"],
    correctCategories: [0, 1, 0, 1, 0, 1],
    explanation: "Synchronized cardioversion is for unstable tachydysrhythmias WITH a pulse and an identifiable R wave: SVT, A-fib/flutter, monomorphic VT. Unsynchronized defibrillation is for: pulseless VT, VF, and polymorphic VT (even with a pulse) — because the irregular QRS morphology makes sync unreliable and may delay the shock. Treat polymorphic VT like VF.",
    clinical_pearl: "Polymorphic VT (Torsades) with a pulse is treated with unsynchronized defibrillation because the monitor cannot reliably identify R waves in the chaotic rhythm. Also give magnesium 2g IV. If you accidentally cardiovert VF/polymorphic VT in sync mode, the device may not fire — switch to defib immediately."
  },
  {
    id: "para-011",
    level: "Paramedic",
    type: "mr",
    domain: "Pharmacology",
    topic: "Vasopressor Selection",
    difficulty: "hard",
    stem: "A 70-year-old female is in septic shock. After 2 liters of NS, her BP is 74/42 with HR 118. MAP is 53. You have peripheral IV access only. Which TWO interventions are MOST appropriate? (Select 2)",
    options: [
      "Push-dose epinephrine (10 mcg/mL) — 0.5-2 mL IV every 2-5 minutes",
      "Norepinephrine drip through the peripheral IV as a bridge",
      "Epinephrine 1 mg IV push (cardiac arrest dose)",
      "Phenylephrine bolus 100 mcg IV",
      "Dopamine infusion at 10-20 mcg/kg/min via peripheral IV"
    ],
    selectCount: 2,
    correctMulti: [0, 1],
    explanation: "Push-dose epinephrine (10 mcg/mL concentration, given 0.5-2 mL = 5-20 mcg per dose) is the ideal bridge pressor for emergency hypotension via peripheral IV. Norepinephrine can be safely run through a peripheral IV for short durations as a bridge — recent evidence supports this practice (previously taught as central-line only). Cardiac arrest dose epi (1 mg) would cause dangerous hypertension/tachycardia in a patient with a pulse. Phenylephrine is a pure alpha agonist — less ideal in sepsis where cardiac output support (beta effect) is also needed. Dopamine has more adverse effects (tachyarrhythmias) and is no longer first-line for septic shock.",
    clinical_pearl: "Push-dose epi recipe: Take 1 mL of 1:10,000 epi (0.1 mg/mL) and add to 9 mL NS = 10 mcg/mL. Give 0.5-2 mL every 2-5 min. This is your 'bridge' pressor while establishing a drip. Label the syringe clearly!"
  },
  {
    id: "para-012",
    level: "Paramedic",
    type: "categorize",
    domain: "Medical Emergencies",
    topic: "H's and T's of Cardiac Arrest",
    difficulty: "hard",
    stem: "During a cardiac arrest resuscitation, you are systematically considering reversible causes. Categorize each finding with its corresponding reversible cause category:",
    items: [
      "Patient found in bathtub, core temp 29°C",
      "Dialysis patient, peaked T waves on monitor",
      "Heroin user found with apnea, miosis",
      "Unrestrained MVC driver with flat neck veins and clear lungs",
      "Recent long-haul flight, acute dyspnea before arrest"
    ],
    categories: ["Hypothermia", "Hyperkalemia", "Hypoxia/Toxins", "Hypovolemia", "Thrombosis (Pulmonary)"],
    correctCategories: [0, 1, 2, 3, 4],
    explanation: "Hypothermia: submersion/cold exposure with core temp < 30°C — 'not dead until warm and dead.' Hyperkalemia: dialysis patients are high-risk; peaked T waves are classic. Hypoxia/Toxins: heroin OD causes respiratory depression → hypoxic arrest (give naloxone + ventilate). Hypovolemia: trauma mechanism + flat neck veins + clear lungs = hemorrhagic shock. Thrombosis (PE): recent immobilization/travel + acute dyspnea — consider tPA in arrest.",
    clinical_pearl: "Remember the H's and T's: Hypovolemia, Hypoxia, Hydrogen ion (acidosis), Hypo/Hyperkalemia, Hypothermia — Tension pneumothorax, Tamponade, Toxins, Thrombosis (coronary/pulmonary). Treat the CAUSE, not just the rhythm."
  },
  {
    id: "para-013",
    level: "Paramedic",
    type: "graphical",
    domain: "Cardiology",
    topic: "Dysrhythmia Interpretation — Wide Complex Tachycardia",
    difficulty: "hard",
    stem: "A 45-year-old male presents with palpitations and near-syncope. The monitor shows a regular wide-complex tachycardia at 180 bpm. QRS duration is 0.16 seconds. There are AV dissociation and capture beats visible. The morphology in V1 shows a monophasic R wave. BP is 96/62. The patient is awake and talking. What is the MOST likely rhythm and appropriate FIRST intervention?",
    image: null,
    options: [
      "Ventricular tachycardia — synchronized cardioversion at 100J",
      "SVT with aberrant conduction — adenosine 6 mg rapid IV push",
      "Ventricular tachycardia — amiodarone 150 mg IV over 10 minutes",
      "Atrial flutter with 1:1 conduction — diltiazem 0.25 mg/kg IV"
    ],
    correct: 0,
    explanation: "AV dissociation and capture beats are pathognomonic for ventricular tachycardia (Brugada criteria). A monophasic R wave in V1 also favors VT. The patient is hemodynamically unstable (near-syncope, BP 96/62), making synchronized cardioversion the first-line treatment. Amiodarone would be appropriate for stable VT. Adenosine could be diagnostic but delays definitive treatment in an unstable patient. Never give calcium channel blockers for wide-complex tachycardia — can cause cardiovascular collapse if it's VT.",
    clinical_pearl: "When in doubt, treat wide-complex tachycardia as VT. Giving adenosine to true VT is generally safe (it just won't work), but giving diltiazem/verapamil to VT can be fatal. AV dissociation = VT until proven otherwise."
  },
  {
    id: "para-014",
    level: "Paramedic",
    type: "table",
    domain: "EMS Operations",
    topic: "Multi-System Trauma Triage — START/JumpSTART",
    difficulty: "hard",
    stem: "You arrive first on scene to an MCI involving a school bus rollover. Using START triage, categorize each patient by selecting the correct triage category:",
    rows: [
      "8-year-old: walking, crying, abrasion on forehead",
      "10-year-old: not walking, RR 32, radial pulse present, follows commands",
      "6-year-old: not breathing, no breath after head-tilt/jaw-thrust",
      "12-year-old: not walking, RR 8, no radial pulse",
      "9-year-old: not walking, RR 24, radial pulse present, does not follow commands"
    ],
    columns: [
      "Green (Minor)",
      "Yellow (Delayed)",
      "Red (Immediate)",
      "Black (Expectant)"
    ],
    correctCells: [
      [1, 0, 0, 0],
      [0, 1, 0, 0],
      [0, 0, 0, 1],
      [0, 0, 1, 0],
      [0, 0, 1, 0]
    ],
    explanation: "START/JumpSTART triage: (1) Walking = GREEN. (2) Not walking, RR 32 (abnormal but breathing), has radial pulse, follows commands = YELLOW. (3) Not breathing after airway maneuver = BLACK (in JumpSTART for kids, give 5 rescue breaths first; if still no breathing = BLACK/expectant). (4) RR 8 (abnormal), no radial pulse = RED (immediate). (5) Has respirations and pulse but doesn't follow commands (altered mental status) = RED.",
    clinical_pearl: "JumpSTART modifies START for pediatrics: if a child is apneic but has a pulse, give 5 rescue breaths. If breathing resumes → RED. If not → BLACK. This differs from adult START where apnea after positioning = BLACK immediately."
  },
  {
    id: "para-015",
    level: "Paramedic",
    type: "mc",
    domain: "Pharmacology",
    topic: "Pediatric Weight-Based Dosing — Seizure Management",
    difficulty: "hard",
    stem: "A 4-year-old (20 kg) is in status epilepticus. Seizures have been continuous for 8 minutes. IV access has been established. Per current guidelines, what is the correct FIRST-LINE medication and dose?",
    options: [
      "Midazolam 0.1 mg/kg IV = 2 mg IV",
      "Diazepam 0.5 mg/kg IV = 10 mg IV",
      "Lorazepam 0.1 mg/kg IV = 2 mg IV",
      "Phenytoin 20 mg/kg IV = 400 mg IV"
    ],
    correct: 2,
    explanation: "Lorazepam (Ativan) 0.1 mg/kg IV is the first-line benzodiazepine for status epilepticus when IV access is available (per ACEP and AAN guidelines). For a 20 kg child: 0.1 × 20 = 2 mg IV. Midazolam IM (0.2 mg/kg) is preferred when no IV access exists. Diazepam 0.5 mg/kg would be a massive overdose (correct dose is 0.15-0.2 mg/kg). Phenytoin is a second-line agent used after benzodiazepines fail.",
    clinical_pearl: "Route matters for seizure management: IV access → lorazepam. No IV → midazolam IM (or intranasal). Rectal diazepam is an option for kids but IM midazolam has been shown to be faster and equally effective (RAMPART trial)."
  }
];

/* ===== APP STATE ===== */
const LEVELS=[
  {key:"EMT",title:"EMT",sub:"Emergency Medical Technician",desc:"Traditional multiple choice format"},
  {key:"AEMT",title:"AEMT",sub:"Advanced EMT",desc:"Clinical judgment format — all question types"},
  {key:"Paramedic",title:"Paramedic",sub:"Paramedic",desc:"Advanced clinical judgment format"}
];

let selectedLevel=null;
let selectedDomain="All";
let questionCount=10;
let quizQs=[];
let qIdx=0;
let submitted=false;
let answers=[];
let userState={};

function getQsForLevel(lvl){return QUESTIONS.filter(q=>q.level===lvl)}
function getDomainsForLevel(lvl){
  const qs=getQsForLevel(lvl);
  const ds=[...new Set(qs.map(q=>q.domain))];
  return ds.sort();
}

/* ===== HOME ===== */
function buildHome(){
  const totalQ=QUESTIONS.length;
  const allDomains=new Set(QUESTIONS.map(q=>q.domain));
  document.getElementById('homeStatQ').textContent=totalQ;
  document.getElementById('homeStatD').textContent=allDomains.size;

  const el=document.getElementById('levelList');
  el.innerHTML='';
  LEVELS.forEach(l=>{
    const qs=getQsForLevel(l.key);
    const div=document.createElement('div');
    const disabled=qs.length===0;
    div.className='level-card'+(disabled?' disabled':'');
    div.innerHTML=`<div class="level-title">${l.title} — ${l.sub}</div><div class="level-sub">${l.desc}</div><div class="level-count">${disabled?'Coming soon':qs.length+' questions'}</div>`;
    if(!disabled) div.onclick=()=>{selectedLevel=l.key;selectedDomain="All";questionCount=10;showSetup()};
    el.appendChild(div);
  });
}

/* ===== SETUP ===== */
function showSetup(){
  show('setup');
  const lvl=LEVELS.find(l=>l.key===selectedLevel);
  document.getElementById('setupTitle').textContent=lvl.title;
  document.getElementById('setupSub').textContent=lvl.sub;
  buildDomains();
  updateCount();
}

function buildDomains(){
  const el=document.getElementById('domainList');
  el.innerHTML='';
  const qs=getQsForLevel(selectedLevel);
  const domains=getDomainsForLevel(selectedLevel);
  const all=[{name:"All",count:qs.length},...domains.map(d=>({name:d,count:qs.filter(q=>q.domain===d).length}))];
  all.forEach(d=>{
    const div=document.createElement('div');
    div.className='domain-item'+(selectedDomain===d.name?' sel':'');
    div.innerHTML=`<span>${d.name}</span><span class="ct">${d.count}</span>`;
    div.onclick=()=>{selectedDomain=d.name;buildDomains();updateCount()};
    el.appendChild(div);
  });
}

function getMaxCount(){
  const qs=selectedDomain==="All"?getQsForLevel(selectedLevel):getQsForLevel(selectedLevel).filter(q=>q.domain===selectedDomain);
  return qs.length;
}

function updateCount(){
  const max=getMaxCount();
  if(questionCount>max) questionCount=max;
  if(questionCount<1) questionCount=1;
  document.getElementById('countVal').textContent=questionCount;
}

function adjCount(d){
  questionCount+=d;
  const max=getMaxCount();
  if(questionCount>max) questionCount=max;
  if(questionCount<1) questionCount=1;
  document.getElementById('countVal').textContent=questionCount;
}

/* ===== NAV ===== */
function show(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');window.scrollTo(0,0)}
function goHome(){show('home');buildHome()}

/* ===== QUIZ ===== */
function startQuiz(){
  let pool=selectedDomain==="All"?getQsForLevel(selectedLevel):getQsForLevel(selectedLevel).filter(q=>q.domain===selectedDomain);
  if(!pool.length)return;
  // Shuffle
  pool=[...pool];
  for(let i=pool.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[pool[i],pool[j]]=[pool[j],pool[i]]}
  quizQs=pool.slice(0,questionCount);
  qIdx=0;answers=[];
  show('quiz');
  renderQuestion();
}

function renderQuestion(){
  submitted=false;
  userState={};
  const q=quizQs[qIdx];
  document.getElementById('qCounter').textContent=`${qIdx+1} / ${quizQs.length}`;
  document.getElementById('progFill').style.width=((qIdx/quizQs.length)*100)+'%';
  document.getElementById('submitBtn').style.display='';
  document.getElementById('nextBtn').style.display='none';
  document.getElementById('qExplanation').style.display='none';
  document.getElementById('qText').textContent=q.question||q.stem;
  document.getElementById('qHint').style.display='none';

  // Scenario
  const sp=document.getElementById('scenarioPanel');
  if(q.scenarioId){
    sp.style.display='';
    const scenarioQs=quizQs.filter(x=>x.scenarioId===q.scenarioId);
    const scenarioIdx=scenarioQs.indexOf(q);
    const phases=['enRoute','scene','postScene'];
    const phaseLabels=['En Route','On Scene','Post-Scene'];
    const tabs=document.getElementById('scenarioTabs');
    tabs.innerHTML='';
    const allScenario={};
    scenarioQs.forEach(sq=>{if(sq.scenario)Object.assign(allScenario,sq.scenario)});
    let shownPhase=null;
    phases.forEach((p,i)=>{
      if(!allScenario[p])return;
      const unlocked=i<=scenarioIdx;
      const tab=document.createElement('div');
      tab.className='scenario-tab'+(unlocked?'':' locked');
      if(i===scenarioIdx){tab.classList.add('active');shownPhase=p}
      tab.textContent=phaseLabels[i];
      if(unlocked)tab.onclick=()=>{
        tabs.querySelectorAll('.scenario-tab').forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById('scenarioText').textContent=allScenario[p];
      };
      tabs.appendChild(tab);
    });
    document.getElementById('scenarioText').textContent=allScenario[shownPhase]||'';
  } else {
    sp.style.display='none';
  }

  // Image area
  const imgArea=document.getElementById('qImageArea');
  imgArea.innerHTML='';
  if(q.type==='graphical'){
    if(q.image){
      imgArea.innerHTML=`<img class="q-image" src="${q.image}" alt="Clinical image">`;
    } else if(q.imageText){
      imgArea.innerHTML=`<div class="q-image-placeholder">${q.imageText}</div>`;
    }
  }

  // Hint
  if(q.type==='mr'&&q.selectCount){
    document.getElementById('qHint').style.display='';
    document.getElementById('qHint').textContent=`Select ${q.selectCount} answers`;
  }

  // Body
  const body=document.getElementById('qBody');
  body.innerHTML='';

  if(q.type==='mc'||q.type==='graphical'){
    userState.selected=-1;
    const ol=document.createElement('div');ol.className='opt-list';
    q.options.forEach((o,i)=>{
      const d=document.createElement('div');d.className='opt';d.dataset.i=i;
      d.innerHTML=`<div class="opt-marker">${String.fromCharCode(65+i)}</div><div>${o}</div>`;
      d.onclick=()=>{if(submitted)return;userState.selected=i;ol.querySelectorAll('.opt').forEach(x=>x.classList.remove('selected'));d.classList.add('selected')};
      ol.appendChild(d);
    });
    body.appendChild(ol);
  }
  else if(q.type==='mr'){
    userState.selected=new Set();
    const ol=document.createElement('div');ol.className='opt-list';
    q.options.forEach((o,i)=>{
      const d=document.createElement('div');d.className='opt';d.dataset.i=i;
      d.innerHTML=`<div class="opt-marker check">\u2610</div><div>${o}</div>`;
      d.onclick=()=>{if(submitted)return;if(userState.selected.has(i)){userState.selected.delete(i);d.classList.remove('selected');d.querySelector('.opt-marker').textContent='\u2610'}else{userState.selected.add(i);d.classList.add('selected');d.querySelector('.opt-marker').textContent='\u2611'}};
      ol.appendChild(d);
    });
    body.appendChild(ol);
  }
  else if(q.type==='order'){
    userState.order=q.items.map((_,i)=>i);
    renderOrder(body,q);
  }
  else if(q.type==='categorize'){
    userState.assignments=new Array(q.items.length).fill(-1);
    userState.pickedItem=-1;
    renderCategorize(body,q);
  }
  else if(q.type==='table'){
    userState.cells=q.rows.map(()=>q.columns.map(()=>0));
    renderTable(body,q);
  }
}

function renderOrder(body,q){
  body.innerHTML='';
  const ol=document.createElement('div');ol.className='order-list';
  userState.order.forEach((origIdx,pos)=>{
    const d=document.createElement('div');d.className='order-item';d.dataset.pos=pos;
    d.innerHTML=`<div class="arrows"><button onclick="moveOrder(${pos},-1)">\u25B2</button><button onclick="moveOrder(${pos},1)">\u25BC</button></div><div class="order-text">${q.items[origIdx]}</div>`;
    if(submitted){
      const correctOrigIdx=q.correctOrder[pos];
      d.classList.add(origIdx===correctOrigIdx?'correct-show':'wrong-show');
      d.querySelector('.arrows').querySelectorAll('button').forEach(b=>b.disabled=true);
    }
    ol.appendChild(d);
  });
  body.appendChild(ol);
}

function moveOrder(pos,dir){
  if(submitted)return;
  const np=pos+dir;
  if(np<0||np>=userState.order.length)return;
  [userState.order[pos],userState.order[np]]=[userState.order[np],userState.order[pos]];
  renderOrder(document.getElementById('qBody'),quizQs[qIdx]);
}

function renderCategorize(body,q){
  body.innerHTML='';
  const chips=document.createElement('div');chips.className='cat-items';
  q.items.forEach((item,i)=>{
    const c=document.createElement('div');
    c.className='cat-chip'+(userState.assignments[i]>=0?' placed':'')+(userState.pickedItem===i?' picked':'');
    c.textContent=item;
    c.onclick=()=>{
      if(submitted)return;
      if(userState.assignments[i]>=0){userState.assignments[i]=-1;userState.pickedItem=-1;renderCategorize(body,q);return}
      userState.pickedItem=i;renderCategorize(body,q);
    };
    chips.appendChild(c);
  });
  body.appendChild(chips);

  const buckets=document.createElement('div');buckets.className='cat-buckets';
  q.categories.forEach((cat,ci)=>{
    const b=document.createElement('div');b.className='cat-bucket'+(userState.pickedItem>=0?' highlight':'');
    b.innerHTML=`<div class="cat-bucket-title">${cat}</div><div class="cat-bucket-items"></div>`;
    const itemsDiv=b.querySelector('.cat-bucket-items');
    userState.assignments.forEach((a,ii)=>{
      if(a===ci){
        const pc=document.createElement('div');pc.className='placed-chip';pc.textContent=q.items[ii];
        if(submitted){pc.style.background=q.correctCategories[ii]===ci?'rgba(52,199,89,.3)':'rgba(217,83,79,.3)'}
        else{pc.onclick=()=>{userState.assignments[ii]=-1;renderCategorize(body,q)}}
        itemsDiv.appendChild(pc);
      }
    });
    b.onclick=(e)=>{
      if(submitted||e.target.classList.contains('placed-chip'))return;
      if(userState.pickedItem>=0){userState.assignments[userState.pickedItem]=ci;userState.pickedItem=-1;renderCategorize(body,q)}
    };
    buckets.appendChild(b);
  });
  body.appendChild(buckets);
}

function renderTable(body,q){
  body.innerHTML='';
  const t=document.createElement('table');t.className='q-table';
  const thead=document.createElement('thead');
  let hr='<tr><th></th>';q.columns.forEach(c=>hr+=`<th>${c}</th>`);hr+='</tr>';
  thead.innerHTML=hr;t.appendChild(thead);
  const tbody=document.createElement('tbody');
  q.rows.forEach((r,ri)=>{
    const tr=document.createElement('tr');
    let html=`<td>${r}</td>`;
    q.columns.forEach((_,ci)=>{
      const on=userState.cells[ri][ci];
      let cls='cell-btn'+(on?' on':'');
      if(submitted){
        if(q.correctCells[ri][ci]&&on)cls+=' correct-show';
        else if(q.correctCells[ri][ci]&&!on)cls+=' correct-show';
        else if(!q.correctCells[ri][ci]&&on)cls+=' wrong-show';
      }
      html+=`<td><button class="${cls}" onclick="toggleCell(${ri},${ci})">${on?'\u2713':''}</button></td>`;
    });
    tr.innerHTML=html;tbody.appendChild(tr);
  });
  t.appendChild(tbody);const wrap=document.createElement('div');wrap.className='table-scroll';wrap.appendChild(t);body.appendChild(wrap);
}

window.toggleCell=function(ri,ci){
  if(submitted)return;
  const q=quizQs[qIdx];
  q.columns.forEach((_,c)=>{userState.cells[ri][c]=0});
  userState.cells[ri][ci]=1;
  renderTable(document.getElementById('qBody'),q);
};

function submitAnswer(){
  if(submitted)return;
  const q=quizQs[qIdx];
  let correct=false;

  if(q.type==='mc'||q.type==='graphical'){
    if(userState.selected<0)return;
    correct=userState.selected===q.correct;
    document.querySelectorAll('#qBody .opt').forEach(o=>{
      const i=+o.dataset.i;
      if(i===q.correct)o.classList.add('correct-show');
      else if(i===userState.selected)o.classList.add('wrong-show');
    });
  }
  else if(q.type==='mr'){
    if(userState.selected.size!==q.selectCount)return;
    const sel=[...userState.selected].sort();
    const cor=[...q.correctMulti].sort();
    correct=JSON.stringify(sel)===JSON.stringify(cor);
    document.querySelectorAll('#qBody .opt').forEach(o=>{
      const i=+o.dataset.i;
      if(q.correctMulti.includes(i))o.classList.add('correct-show');
      else if(userState.selected.has(i))o.classList.add('wrong-show');
    });
  }
  else if(q.type==='order'){
    correct=userState.order.every((orig,pos)=>orig===q.correctOrder[pos]);
  }
  else if(q.type==='categorize'){
    if(userState.assignments.includes(-1))return;
    correct=userState.assignments.every((a,i)=>a===q.correctCategories[i]);
  }
  else if(q.type==='table'){
    correct=q.correctCells.every((row,ri)=>row.every((v,ci)=>v===userState.cells[ri][ci]));
  }

  submitted=true;
  answers.push({qId:q.id,correct,domain:q.domain});

  if(q.type==='order')renderOrder(document.getElementById('qBody'),q);
  if(q.type==='categorize')renderCategorize(document.getElementById('qBody'),q);
  if(q.type==='table')renderTable(document.getElementById('qBody'),q);

  const exp=document.getElementById('qExplanation');
  exp.style.display='';
  let expHTML=`<div class="explanation ${correct?'':'wrong'}"><h4>${correct?'Correct':'Incorrect'}</h4><p>${q.explanation}</p></div>`;
  const pearl=q.pearl||q.clinical_pearl;if(pearl) expHTML+=`<div class="pearl"><strong>Clinical Pearl:</strong> ${pearl}</div>`;
  exp.innerHTML=expHTML;

  document.getElementById('submitBtn').style.display='none';
  document.getElementById('nextBtn').style.display='';
}

function nextQuestion(){
  qIdx++;
  if(qIdx>=quizQs.length){showResults();return}
  renderQuestion();
  window.scrollTo(0,0);
}

function showResults(){
  show('results');
  const total=answers.length;
  const correct=answers.filter(a=>a.correct).length;
  const pct=Math.round((correct/total)*100);
  document.getElementById('resPct').textContent=pct+'%';
  const tier=pct>=90?'Mastery':pct>=75?'Proficient':pct>=60?'Developing':'Needs Review';
  document.getElementById('resTier').textContent=tier;

  const db=document.getElementById('domainBreakdown');db.innerHTML='';
  const domMap={};
  answers.forEach(a=>{if(!domMap[a.domain])domMap[a.domain]={c:0,t:0};domMap[a.domain].t++;if(a.correct)domMap[a.domain].c++});
  Object.entries(domMap).forEach(([d,v])=>{
    const p=Math.round((v.c/v.t)*100);
    const color=p>=75?'#34c759':p>=50?'#f0ad4e':'#d9534f';
    db.innerHTML+=`<div class="domain-bar"><div class="domain-bar-label"><span>${d}</span><span>${v.c}/${v.t}</span></div><div class="domain-bar-track"><div class="domain-bar-fill" style="width:${p}%;background:${color}"></div></div></div>`;
  });

  const rl=document.getElementById('reviewList');rl.innerHTML='';
  answers.forEach((a,i)=>{
    const q=quizQs[i];
    const qRaw=q.question||q.stem;const qText=qRaw.length>80?qRaw.substring(0,80)+'...':qRaw;
    const expText=q.explanation.length>120?q.explanation.substring(0,120)+'...':q.explanation;
    rl.innerHTML+=`<div class="review-item ${a.correct?'rev-correct':'rev-wrong'}"><div class="review-q">${a.correct?'Correct':'Incorrect'} — Q${i+1}: ${qText}</div><div class="review-a">${expText}</div></div>`;
  });
}

/* ===== INIT ===== */
buildHome();
</script>
</body>
</html>